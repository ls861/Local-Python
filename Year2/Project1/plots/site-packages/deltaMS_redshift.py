
# =============================================================================
# Delta MS colour coded by redshift
# =============================================================================

def deltaMS_redshift(ADx_subset, medians, normalisation, figuresize, fontsize_axes, string_mass, string_deltaMS, save):

    import numpy as np
    import matplotlib as mpl
    import matplotlib.pyplot as plt

    fig = plt.figure(figsize=(figuresize, figuresize))
    ax1 = fig.add_axes([0, 0, 0.85, 0.84]) #[left, bottom, width, height]

    # sfr_surface_real = ((medians['beta_a']+ADx_subset['redshift_BEAGLE']*medians['beta_b'])*ADx_subset['mass_BEAGLE_stellar'])+(np.log10(medians['alphaN_a']*((1+ADx_subset['redshift_BEAGLE'])**medians['alphaN_b'])))+normalisation-9.0-(normalisation*(medians['beta_a']+ADx_subset['redshift_BEAGLE']*medians['beta_b'])) # OLD

    # sfr_surface_real = ((medians['beta_a'] + medians['beta_b']*ADx_subset['redshift_BEAGLE'])*(ADx_subset['mass_BEAGLE_stellar']-normalisation)) + (np.log10(medians['alphaN_a']*((1.0+ADx_subset['redshift_BEAGLE'])**medians['alphaN_b']))) + normalisation - 9.0 # error if alphaN_a <0
    # sfr_surface_real = ((medians['beta_a'] + medians['beta_b']*ADx_subset['redshift_BEAGLE'])*(ADx_subset['mass_BEAGLE_stellar']-normalisation)) + (medians['alphaN_a'] + medians['alphaN_b']*ADx_subset['redshift_BEAGLE']) # error if alphaN_a <0
    sfr_surface_real = ((medians['beta_a'] + medians['beta_b']*ADx_subset['redshift_BEAGLE'])*(ADx_subset['mass_BEAGLE_stellar']-normalisation)) + medians['alphaN_a'] + medians['alphaN_b']*np.log10(1.0+ADx_subset['redshift_BEAGLE']) + normalisation - 9.0 # new alphaN_a = old np.log10(alphaN_a)

    idx_sort = np.argsort(ADx_subset['redshift_BEAGLE'])

    scatter = ax1.scatter(ADx_subset['mass_BEAGLE_stellar'][idx_sort], (ADx_subset['sfr_BEAGLE_instant']-sfr_surface_real)[idx_sort], c=ADx_subset['redshift_BEAGLE'][idx_sort], vmin=1.25, vmax=5.8, alpha=1.0)

    x_tmp = np.array((0, 20))
    ax1.plot(x_tmp, x_tmp*0, color='k', alpha=1.0, lw=3)
    ax1.plot(x_tmp, (x_tmp*0)+medians['sig0'], color='k', alpha=1.0, linestyle='dashed', lw=3)
    ax1.plot(x_tmp, (x_tmp*0)-medians['sig0'], color='k', alpha=1.0, linestyle='dashed', lw=3)

    ax1.set_xlim(6.5, 10.5)
    ax1.set_xlabel(string_mass, labelpad=10)
    ax1.xaxis.set_major_locator(mpl.ticker.MultipleLocator(1))
    ax1.xaxis.set_minor_locator(mpl.ticker.MultipleLocator(0.5))
    ax1.xaxis.set_tick_params(which='major', size=10, width=2, direction='in', bottom='on', top='on')
    ax1.xaxis.set_tick_params(which='minor', size=5, width=2, direction='in', bottom='on', top='on')
    ax1.xaxis.set_tick_params(labelsize=fontsize_axes)

    ax1.set_ylim(-2.5, 2.5)
    ax1.set_ylabel(string_deltaMS, labelpad=10)
    ax1.yaxis.set_major_locator(mpl.ticker.MultipleLocator(1))
    ax1.yaxis.set_minor_locator(mpl.ticker.MultipleLocator(0.5))
    ax1.yaxis.set_tick_params(which='major', size=10, width=2, direction='in', left='on', right='on')
    ax1.yaxis.set_tick_params(which='minor', size=5, width=2, direction='in', left='on', right='on')
    ax1.yaxis.set_tick_params(labelsize=fontsize_axes)

    #ax1.legend(bbox_to_anchor=(1, 1), loc=1, frameon=False, fontsize=fontsize_legend)

    cbaxes = fig.add_axes([0.85, 0, 0.05, 0.84]) #[left, bottom, width, height]
    cb = plt.colorbar(scatter, cax = cbaxes)


    cb.set_ticks([0, 1, 2, 3, 4, 5, 6, 7])
    cb.set_ticklabels(['', 1, 2, 3, 4, 5, 6, ''])
    cb.set_label('Redshift', rotation=270, labelpad=30)
    cb.ax.tick_params(axis='y', size=5, width=2, direction='in', labelsize=fontsize_axes)

    if save:
        plt.savefig('deltaMS_redshift.png', dpi=300, transparent=False, bbox_inches='tight')
    plt.show()
